---
title: iOS安装包瘦身记录 # 这是标题
date: 2018-1-22 21:27:00
categories:  # 这里写的分类会自动汇集到 categories 页面上，分类可以多级
- iOS # 一级分类
tags:   # 这里写的标签会自动汇集到 tags 页面上
- iOS
---
随着项目时间越来越久，大家自然而然的一定会面对一个问题:APP安装包越来越大。那就不禁自问一下了，安装包里边的东西都是需要的吗？答案肯定是：不是的!即使都是需要的那有没有优化空间呢？当然肯定也会有的。接下里介绍一下作者安装包瘦身的一次经历。
# 瘦身结果
安装包从68.9M减少到23.M
>大家别急着想作者做了什么居然能减少这么大呢？这里其中有一个狗血的事情。虽然不是每个人都会遇到，但是还是小心为妙！

# 分析和结论
瘦身之前，作者也看了不少有关这方面的文章。其实总结下来虽然优化点挺多的，但是总的来说对于大部分项目来说可以入手做的并且效果比较大可以归纳为一下2点:

* 原生资源

  * 图片
  * 视频
  * 音频
  * 其他内置资源，如城市数据等
* 代码

# 开始瘦身
本人开发的APP之前半年之久，从0开始，所以历史包袱没有。但是发现开发的APP达到将近70M的时候，其实第一反应是不可思议。正好项目有点空闲时间内了，就开始着手瘦身这一事情了。
## 原生资源处理
图片资源其实在大部分项目中占据了不少比例的。
### 图片资源处理
* 删除无用和重复图片的
[LSUnusedResources](https://github.com/tinymind/LSUnusedResources)一个Mac工程，下载下来直接运行。可以用来扫描工程中没有用到的图片。
[fdupes](https://github.com/adrianlopezroche/fdupes)可以在指定的目录及子目录中查找重复的文件。fdupes通过对比文件的MD5签名，以及逐字节比较文件来识别重复内容。
>fdupes -r  xxx/Images.xcassets

工程中历史包袱没有，所以重复和没有用的图片没有那么大。瘦身了0.2M，效果不是非常明显
* 压缩图片
其实很多设计给到的切图质量都很高，没有经过压缩。我们手机端使用的图片可以适当的做压缩处理。这个效果比较明显减少了5.4M

**狗血的事情**
这里压缩过程中，作者居然在工程中发现了一张41.6M的图片！！！。所以建议大家在使用设计给到的图片一定要看看大小！

[TinyPNG](https://tinypng.com/)很不错的一个图片免费在线压缩工具

我压缩了工程中用到的比较大的图片（几十K以上的），小的就没有去压缩。另一个大家一定要注意APP的欢迎页，质量都比较高，尤其大。要不同机型的欢迎页都要压缩一下。
* 压缩gif
由于项目中欢迎页使用几个gif，所以这里压缩了一下，效果还凑合着吧，减少0.3M

### 视频和音频处理
项目中如果有视频音频的话占的比较大的话，大家可以做一下处理。比如音频可以使用ogg等比较小的文件。
# 代码

这里由于没有历史包袱代码层面我们现在项目可优化的不是很大。这里其实主要就是没有用的文件和第三方的引用导致安装包变大。所以没用到的文件肯定要删除，针对比较大的第三方做个取舍。代码重复扫描的话对安装包瘦身效果不是很明显，不过大家可以用来重构项目也是有用的，做个参考

## 查看APP中各个文件的大小

1. LinkMap文件是Xcode产生可执行文件的同时生成的链接信息，用来描述可执行文件的构造成分，包括代码段（__TEXT）和数据段（__DATA）的分布情况。只要设置Project->Build Settings->Write Link Map File为YES，build完后就可以在设置的路径看到LinkMap文件了。
2. 从linkmap中统计出每个.o目标文件占用的体积和每个.a静态库占用的体积 [脚本链接](https://link.jianshu.com/?t=https://gist.github.com/bang590/8f3e9704f1c2661836cd)
# 我的博客
[FlyOceanFish](http://flyoceanfish.top/)
